{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\Game/assets\\scripts\\Game\\Game.js"],"names":["cc","Class","extends","Component","properties","Player1","type","Node","default","Player2","SupplyPrefab","Prefab","ShieldSupplyPrefab","PauseMenuPrefab","EnemyPrefab","StaticEnemyPrefab","TrackEnemyPrefab","SpinEnemyPrefab","SwingEnemyPrefab","CopterEnemyPrefab","BatteryPrefab","BulletPrefab","MapVPrefab","MapHPrefab","Explode1","AudioSource","pauseBtn","Button","MapCamera","Camera","MainCamera","Target","srcX","srcY","dstX","dstY","cameraSpeed","ratio","stateChange","GameOver","schedule","zoomRatio","scheduleOnce","director","loadScene","end","onLoad","node","on","pauseScene","i","children","length","name","zIndex","sortAllChildren","start","cameraMove","child","active","pause","targetExist","grandSon","group","exist","timeID","clearTimeout","undefined","setTimeout","bind","getChildByName","Menu","instantiate","x","y","addChild","srcx","srcy","dstx","dsty","initRatio","update","dt","getComponent","Dead","win","stageName","getScene"],"mappings":"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","file":"Game.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\Game","sourcesContent":["/*\n * 关卡模式控制脚本\n */\n\ncc.Class({\n  extends: cc.Component,\n\n  properties: {\n    Player1: {\n      type: cc.Node,\n      default: null\n    },\n    Player2: {\n      type: cc.Node,\n      default: null\n    },\n    SupplyPrefab: {\n      default: null,\n      type: cc.Prefab\n    },\n    ShieldSupplyPrefab: {\n      default: null,\n      type: cc.Prefab\n    },\n    PauseMenuPrefab: {\n      default: null,\n      type: cc.Prefab\n    },\n    EnemyPrefab: {\n      type: cc.Prefab,\n      default: null\n    },\n    StaticEnemyPrefab: {\n      type: cc.Prefab,\n      default: null\n    },\n    TrackEnemyPrefab: {\n      type: cc.Prefab,\n      default: null\n    },\n    SpinEnemyPrefab: {\n      type: cc.Prefab,\n      default: null\n    },\n    SwingEnemyPrefab: {\n      type: cc.Prefab,\n      default: null\n    },\n    CopterEnemyPrefab: {\n      type: cc.Prefab,\n      default: null\n    },\n    BatteryPrefab: {\n      type: cc.Prefab,\n      default: null\n    },\n    BulletPrefab: {\n      type: cc.Prefab,\n      default: null\n    },\n    MapVPrefab: {\n      type: cc.Prefab,\n      default: null\n    },\n    MapHPrefab: {\n      type: cc.Prefab,\n      default: null\n    },\n    Explode1: {\n      type: cc.AudioSource,\n      default: null\n    },\n    pauseBtn: {\n      type: cc.Button,\n      default: null\n    },\n    MapCamera: {\n      type: cc.Camera,\n      default: null\n    },\n    MainCamera: {\n      type: cc.Camera,\n      default: null\n    },\n    Target: {\n      type: cc.Node,\n      default: null\n    },\n    srcX: 0, // 相机移动初始位置\n    srcY: 0,\n    dstX: 0, // 相机移动最终位置\n    dstY: 0,\n    cameraSpeed: 0, // 相机移动速度\n    ratio: 0, // 相机放缩比\n    stateChange: false // 暂停状态记录\n  },\n\n  /*\n     * 游戏结束函数\n     * 功能：执行游戏结束的动作，设置定时器缩小相机焦距，\n     *      并且准备定时加载场景，将游戏状态设成结束\n     */\n  GameOver: function () {\n    this.schedule(() => {\n      this.MainCamera.zoomRatio -= 0.008\n    }, 0.001)\n\n    this.scheduleOnce(() => {\n      cc.director.loadScene('Transition')\n    }, 2)\n\n    this.end = true\n  },\n\n  /*\n     * 初始化函数\n     * 功能：初始化脚本所需的设定\n     */\n  onLoad () {\n    // 设置暂停按钮的回调函数\n    this.pauseBtn.node.on('click', this.pauseScene, this)\n\n    // 设置各个游戏对象的zIndex，确保显示层级的正确\n    for (var i = 0; i < this.node.children.length; ++i) {\n      switch (this.node.children[i].name) {\n        case 'player1': {\n          this.node.children[i].zIndex = 100\n          break\n        }\n        case 'player2': {\n          this.node.children[i].zIndex = 100\n          break\n        }\n        case 'stickLeft':\n        case 'stickRight': {\n          this.node.children[i].zIndex = 101\n          break\n        }\n        case 'bg': {\n          this.node.children[i].zIndex = -100\n          break\n        }\n      }\n    }\n    this.node.sortAllChildren()\n  },\n\n  start () {\n    // 将游戏结束状态参数设成假\n    this.end = false\n\n    // 将游戏状态改变变量设成假\n    this.stateChange = false\n\n    // 设定全景相机的移动\n    this.cameraMove(this.srcX, this.srcY, this.dstX, this.dstY, this.ratio)\n  },\n\n  /*\n     * 暂停函数\n     * 功能：暂停/恢复当前场景，并设置其每一个子节点的运行状态\n     */\n  pauseScene () {\n    for (var child of this.node.children) {\n      // 遍历Canvas的每一个子节点，将其设为活跃/不活跃状态\n      switch (child.name) {\n        case 'Enemy':\n        case 'Map':\n        case 'player1':\n        case 'player2':\n        case 'bullet':\n        case 'bind': {\n          // 普通对象直接根据暂停还是恢复来设置活跃状态\n          child.active = this.pause\n          break\n        }\n        case 'target': {\n          // 将暂停前的target活跃状态记录，并在恢复时进行恢复\n          if (!this.pause) {\n            this.targetExist = child.active\n            child.active = false\n          } else {\n            child.active = this.targetExist\n          }\n          break\n        }\n        case 'UI': {\n          /*\n                     * 以下函数有些繁琐，目的是为了记录护盾对象\n                     * 的存在状态，并在恢复时进行恢复。同时，由于\n                     * 护盾本身存在寿命，所以我们对恢复后的寿命给\n                     * 出一个统计的平均数——2.5s\n                     */\n          for (var grandSon of child.children) {\n            if (grandSon.group !== 'Shield') {\n              grandSon.active = this.pause\n            } else {\n              if (!this.pause) {\n                grandSon.exist = grandSon.active\n                grandSon.active = false\n                if (grandSon.timeID) {\n                  clearTimeout(grandSon.timeID)\n                  grandSon.timeID = undefined\n                }\n              } else {\n                grandSon.active = grandSon.exist\n                grandSon.exist = false\n                if (grandSon.active) {\n                  if (grandSon.name === 'shieldLeft') {\n                    grandSon.timeID = setTimeout(function () {\n                      this.active = false\n                    }.bind(this.node.getChildByName('UI').getChildByName('shieldLeft')), 2500)\n                  } else {\n                    grandSon.timeID = setTimeout(function () {\n                      this.active = false\n                    }.bind(this.node.getChildByName('UI').getChildByName('shieldRight')), 2500)\n                  }\n                }\n              }\n            }\n          }\n          break\n        }\n      }\n    }\n\n    // 修改场景的暂停状态\n    this.pause = !this.pause\n\n    if (this.pause) {\n      // 如果当前操作是要暂停此场景\n      // 则要显示一个暂停菜单\n      var Menu = cc.instantiate(this.PauseMenuPrefab)\n      Menu.x = 0\n      Menu.y = 0\n      Menu.group = 'UI'\n      this.node.getChildByName('UI').active = true\n      this.node.getChildByName('UI').addChild(Menu)\n    }\n  },\n\n  /*\n     * 相机移动功能\n     * 功能：定时缩放相机的焦距和移动相机的焦点，\n     *      使得玩家在开场前可以总览地图全局面貌\n     */\n  cameraMove (srcx, srcy, dstx, dsty, initRatio) {\n    this.MapCamera.node.x = srcx\n    this.MapCamera.node.y = srcy\n\n    var x = dstx - srcx\n    var y = dsty - srcy\n\n    this.scheduleOnce(function () {\n      this.schedule(function () {\n        if (this.MapCamera.zoomRatio > 1) {\n          this.MapCamera.node.active = false\n        } else {\n          this.MapCamera.zoomRatio += this.cameraSpeed\n          this.MapCamera.node.x += x * this.cameraSpeed / (1 - initRatio)\n          this.MapCamera.node.y += y * this.cameraSpeed / (1 - initRatio)\n        }\n      }, 0.0001)\n    }, 0.8)\n  },\n\n  // 系统调用的更新函数\n  update (dt) {\n    if (this.end) {\n      // 如果检测到游戏已经结束，则停止更新\n      return\n    }\n\n    if (this.stateChange && !this.end) {\n      // 如果检测到游戏状态发生改变（从子部件处设此变量为真），\n      // 则调用暂停函数，并恢复stateChange变量为假\n      this.pauseScene()\n      this.stateChange = false\n    }\n\n    if (this.Player1.getComponent('Player').Dead && !this.end) {\n      // 如果检测到玩家死亡，则游戏结束，并且立即返回\n      this.GameOver()\n      return\n    }\n    if (this.Player2.getComponent('Player').Dead && !this.end) {\n      this.GameOver()\n      return\n    }\n\n    if (this.Target.getComponent('Target').win && !this.end) {\n      // 如果检测到玩家通关，则游戏结束\n      var stageName = cc.director.getScene().name\n      if (stageName === 'Stage12') {\n        // 如果当前是最后一关，则调用结束字幕\n        cc.director.loadScene('End')\n        return\n      }\n      // 否则进入正常的游戏结束函数\n      this.GameOver()\n    }\n  }\n})\n"]}