{"version":3,"sources":["Player.js"],"names":["cc","Class","extends","Component","properties","life","shield","immortalDuration","speed","Dead","BlastPrefab","type","Prefab","default","PlayerHit","AudioSource","Death","Bonus","LifeLabel","Label","ShieldLabel","onLoad","director","getCollisionManager","enabled","start","blastName","node","name","immortal","collideMap","lifeLabel","getComponent","string","shieldLabel","onCollisionEnter","other","self","group","mapCollision","enemyCollision","_name","play","blast","instantiate","parent","addChild","setPosition","x","y","animComponent","Animation","lostLife","onCollisionStay","onCollisionExit","GameOver","action","sequence","fadeOut","fadeIn","repeat","runAction","setTimeout","bind","sceneName","getScene","data","Stage","Win","sys","localStorage","setItem","JSON","stringify","objMap","objEnemy","speedX","speedY","update","dt"],"mappings":"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","file":"Player.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\Game","sourcesContent":["/*\n * 主角脚本\n */\n\ncc.Class({\n  extends: cc.Component,\n\n  properties: {\n    life: 3, // 主角生命\n    shield: 3, // 主角护盾数\n    immortalDuration: 2, // 碰撞后的短暂无敌时间\n    speed: 5, // 主角速度\n    Dead: false,\n    BlastPrefab: {\n      type: cc.Prefab,\n      default: null\n    },\n    // 音效\n    PlayerHit: {\n      type: cc.AudioSource,\n      default: null\n    },\n    Death: {\n      type: cc.AudioSource,\n      default: null\n    },\n    Bonus: {\n      type: cc.AudioSource,\n      default: null\n    },\n    LifeLabel: {\n      type: cc.Label,\n      default: null\n    },\n    ShieldLabel: {\n      type: cc.Label,\n      default: null\n    }\n\n  },\n\n  // LIFE-CYCLE CALLBACKS:\n  onLoad () {\n    // 开启碰撞检测\n    cc.director.getCollisionManager().enabled = true\n  },\n\n  start () {\n    this.blastName = 'blast' + this.node.name[6]\n    this.immortal = false\n    this.collideMap = false\n    this.lifeLabel = this.LifeLabel.getComponent(cc.Label)\n    this.lifeLabel.string = this.life\n    this.shieldLabel = this.ShieldLabel.getComponent(cc.Label)\n    this.shieldLabel.string = this.shield\n  },\n\n  /*\n     * 角色的碰撞事件\n     */\n  onCollisionEnter (other, self) {\n    // 获取碰撞对象的类型\n    var group = other.node.group\n    switch (group) {\n      case 'Map': {\n        // 当碰到的是地图边界时\n        this.collideMap = true\n        this.mapCollision(other)\n        break\n      }\n      case 'Enemy': {\n        // 当碰到了敌人时\n        this.enemyCollision(other)\n        break\n      }\n      case 'Supply': {\n        // 当碰到了补给\n        if (other.node._name === 'supply') {\n          this.life++\n        } else if (other.node._name === 'shieldSupply') {\n          this.shield++\n        }\n        this.Bonus.play()\n        break\n      }\n      case 'Bullet': {\n        // 当碰到了子弹\n        var blast = cc.instantiate(this.BlastPrefab)\n        this.node.parent.addChild(blast)\n        blast.setPosition(this.node.x, this.node.y)\n        var animComponent = blast.getComponent(cc.Animation)\n        animComponent.play(this.blastName)\n\n        this.PlayerHit.play()\n\n        this.lostLife()\n        break\n      }\n      default: {\n        // Others\n        break\n      }\n    }\n  },\n\n  onCollisionStay (other, self) {\n    // 获取碰撞对象的类型\n    var group = other.node.group\n    switch (group) {\n      case 'Map': {\n        // 当碰到的是地图边界时\n        this.collideMap = true\n        this.mapCollision(other)\n        break\n      }\n      default: {\n        // Others\n        break\n      }\n    }\n  },\n\n  onCollisionExit (other, self) {\n    var group = other.node.group\n    switch (group) {\n      case 'Map': {\n        // 当碰到的是地图边界时\n        this.collideMap = false\n        break\n      }\n      default: {\n        // Others\n        break\n      }\n    }\n  },\n\n  // 根据主角当前状态确定是否扣血\n  lostLife () {\n    // 若刚损失一条命，处于暂时无敌状态\n    if (!this.immortal) {\n      this.life--\n      this.immortal = true\n      if (this.life < 0) {\n        this.life = 0\n        this.GameOver()\n        return\n      }\n\n      // 主角死亡闪烁表示处于无敌状态\n      var action = cc.sequence(cc.fadeOut(0.125), cc.fadeIn(0.125)).repeat(this.immortalDuration / 0.25)\n      this.node.runAction(action)\n\n      setTimeout(function () {\n        this.immortal = false\n      }.bind(this), 1000 * this.immortalDuration)\n    }\n  },\n\n  GameOver () {\n    var sceneName = cc.director.getScene().name\n    var data = {\n      Stage: sceneName,\n      Win: false\n    }\n    cc.sys.localStorage.setItem('lastStage', JSON.stringify(data))\n    this.Dead = true\n  },\n\n  /*\n     * 与地图的碰撞事件\n     */\n  mapCollision (objMap) {\n    var name = objMap.node._name\n    // 直接回弹\n    switch (name) {\n      case 'mapV': {\n        if (objMap.node.x < this.node.x) {\n          this.node.x = this.node.x + this.speed + 1\n        } else if (objMap.node.x > this.node.x) {\n          this.node.x = this.node.x - this.speed - 1\n        }\n\n        break\n      }\n      case 'mapH': {\n        if (objMap.node.y < this.node.y) {\n          this.node.y = this.node.y + this.speed + 1\n        } else if (objMap.node.y > this.node.y) {\n          this.node.y = this.node.y - this.speed - 1\n        }\n      }\n    }\n  },\n\n  /*\n     * 与敌人的碰撞事件\n     */\n  enemyCollision (objEnemy) {\n    var name = objEnemy.node.name\n    switch (name) {\n      // 直接回弹\n      case 'battery': {\n        this.speedX = -this.speedX\n        this.speedY = -this.speedY\n        break\n      }\n      // 生命减少\n      case 'enemy':\n      case 'enemy_static':\n      case 'enemy_spin':\n      case 'enemy_swing':\n      case 'enemy_copter':\n      case 'enemy_track': {\n        var blast = cc.instantiate(this.BlastPrefab)\n        this.node.parent.addChild(blast)\n        blast.setPosition(this.node.x, this.node.y)\n\n        var animComponent = blast.getComponent(cc.Animation)\n        animComponent.play(this.blastName)\n\n        this.PlayerHit.play()\n\n        this.lostLife()\n        break\n      }\n    }\n  },\n\n  update (dt) {\n    // 生命值更新\n    this.lifeLabel.string = this.life\n    this.shieldLabel.string = this.shield\n  }\n})\n"]}