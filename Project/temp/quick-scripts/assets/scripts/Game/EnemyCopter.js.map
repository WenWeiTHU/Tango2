{"version":3,"sources":["EnemyCopter.js"],"names":["cc","Class","extends","require","properties","BulletPrefab","type","Prefab","default","Body","Node","Fly","shootTime","shootInterval","shootNum","bulletSpeed","flyRotationUpdate","shoot","schedule","createBullet","dir","v2","Player","x","node","y","newBullet","instantiate","bulletSetting","getComponent","r","Math","atan2","degree","PI","rotation","direction","speed","parent","addChild","sortAllChildren","start","angle","circulateDir","flyDegree","face","circulateUpdate","centerX","radius","sin","centerY","cos","updateFlyDegree","dt","distance","mag","centerSpeed","update"],"mappings":"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","file":"EnemyCopter.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\Game","sourcesContent":["/*\n * 直升机敌人脚本\n */\n\ncc.Class({\n  extends: require('EnemySpin'),\n\n  properties: {\n    BulletPrefab: {\n      type: cc.Prefab,\n      default: null\n    },\n    Body: {\n      type: cc.Node,\n      default: null\n    },\n    Fly: {\n      type: cc.Node,\n      default: null\n    },\n    shootTime: 3, // 射击时间间隔\n    shootInterval: 0.3, // 连发子弹射击间隔\n    shootNum: 3, // 射击数\n    bulletSpeed: 100, // 子弹速度\n    flyRotationUpdate: 15 // 旋翼自转速度\n  },\n\n  // LIFE-CYCLE CALLBACKS:\n\n  // onLoad () {},\n\n  /*\n     * 发射子弹函数\n     * 功能：间隔一段较短的时间发射多颗子弹\n     */\n  shoot: function () {\n    this.schedule(this.createBullet, this.shootInterval, this.shootNum - 1)\n  },\n\n  /*\n     * 创造子弹函数\n     * 功能：根据给定参数实例化一颗子弹，并且将其添加到本节点的父节点中\n     */\n  createBullet: function () {\n    // 对象和主角的位差向量\n    var dir = cc.v2(this.Player.x - this.node.x, this.Player.y - this.node.y)\n\n    // 构造新子弹，并设置参数\n    var newBullet = cc.instantiate(this.BulletPrefab)\n    var bulletSetting = newBullet.getComponent('Bullet')\n\n    // 计算角度\n    var r = Math.atan2(dir.y, dir.x)\n    var degree = r * 180 / (Math.PI)\n    newBullet.rotation = 450 - degree\n\n    // 设置参数\n    newBullet.x = this.node.x\n    newBullet.y = this.node.y\n    bulletSetting.direction = dir\n    bulletSetting.speed = this.bulletSpeed\n\n    // 添加到父节点中\n    this.node.parent.parent.addChild(newBullet)\n    this.node.parent.sortAllChildren()\n  },\n\n  /*\n     * 初始化函数\n     * 功能：初始化脚本运行所需的参数\n     */\n  start () {\n    this.angle = 0\n    this.circulateDir = 1\n    this.flyDegree = 0\n    this.schedule(this.shoot, this.shootTime)\n  },\n\n  /*\n     * 调整旋转角度函数\n     * 功能：调整对象的旋转角度，使其一直面向主角\n     */\n  face () {\n    this.angle += this.circulateDir * this.circulateUpdate\n    this.angle = this.angle > 360 ? this.angle - 360 : this.angle\n\n    this.node.rotation = this.angle + 180\n\n    this.node.x = this.centerX + this.radius * Math.sin(this.angle * Math.PI / 180)\n    this.node.y = this.centerY + this.radius * Math.cos(this.angle * Math.PI / 180)\n  },\n\n  /*\n     * 更新飞行角度\n     * 功能：改变飞机的飞行角度，使得其绕着主角飞行\n     */\n  updateFlyDegree (dt) {\n    this.flyDegree += this.circulateDir * this.flyRotationUpdate / Math.PI\n    this.flyDegree = this.flyDegree > 360 ? this.flyDegree - 360 : this.flyDegree\n    this.Fly.rotation = this.flyDegree\n\n    this.dir = cc.v2(this.Player.x - this.centerX, this.Player.y - this.centerY)\n    this.distance = this.dir.mag()\n\n    this.centerX += this.dir.x / this.distance * this.centerSpeed * dt\n    this.centerY += this.dir.y / this.distance * this.centerSpeed * dt\n  },\n\n  // 系统调用的更新函数\n  update (dt) {\n    this.updateFlyDegree(dt)\n    this.face()\n  }\n})\n"]}